# CMS系统使用手册（初版） #

**刘鎏 2015-3**

新版的CMS系统基于thinkphp框架新开发的onethink CMS系统框架，在此基础上做了大量修改，扩展和新增了模型管理，静态生成，标签管理，模板管理，内链管理等等模块。

名词解释：

- 数据模块：即为文章，下载，礼包三大模块，或者以后会扩展的其他站点主数据模块

- 基础模型：文档模型，下载模型，礼包模型，专区模型；也就是非独立模型，可扩展。

## 用户 ##

### 用户管理 ###

主要是管理用户，用户组，用户权限

- 用户信息

	增，删，改，查用户；

	可以选择是否启用用户账号；可以给用户分配用户组，用户单独不能分配权限，所有权限都取决于用户所处用户组。

	admin管理员用户拥有所有权限，不受权限限制。

- 权限管理

	增，删，改，查用户组；
 
	访问授权：可以给用户组赋予权限，这里的所有用户权限都取决于**系统管理->菜单管理**，只有在菜单里面有的，才可以在这里分配权限；

	成员授权：可以给用户组分配用户，填入用户的UID即可，UID可以在用户信息中查找。

	分类授权：可以单独分配某个数据模块的分类给某个用户组，让不同用户组可以管理同一个数据模块（未完善）


### 行为管理 ###

管理和记录用户在后台的操作行为，用于分析统计（可扩展）

- 用户行为

	定位管理用户行为，只要在代码中定义了这个行为的就会按照规则记录行为用于统计。

- 行为日志

	各种行为发生的日志。

## 系统 ##

### 系统设置 ###

关键配置，设计到菜单，全局设置等

- 网站设置与配置管理

	这2个功能是一起的，首先在**配置管理**中可以新增配置，需要填写标识，标题，类型分组等，具体可以看其他的配置例子；在这里新增的配置就会自动出现在**网站设置**相应的分组之中，方便非程序人员的修改。

	配置分组本身也是一个配置，存在于**网站设置->用户配置->配置分组**，可以根据具体需要修改和添加。

- 模型管理

	这是整个系统的核心部分，支撑了整个系统的主要数据模块，请谨慎修改。

	- 模型说明
	
		模型本身就是数据库结构，修改模型会自动修改相应数据表的数据结构；

		模型标识即为表名，会自动添加数据库名前缀，不需要手动添加；名称即为可视名称，一个易于理解的名称可以方便管理。

		模型类型分为2类：

		- 独立模型：这种模型是一个完全独立的表，和其他表没有直接关系；

		- 非独立模型：目前可选非独立模型有**文档模型，下载模型，礼包模型，专区模型**，选择这类模型说明这个模型为当前选择的模块的一个附属模型，即非独立模型都需要选择一个基础模型，所有同一个基础模型的附属模型同属一个模块，主要的数据都存储于基础模型，附属模型存储比较特殊的数据。2个模型即为2张表，使用同一个主键数据产生联系。		


		标签类型和产品标签类型，即为这个模型的数据可选的标签和产品标签分类，只有勾选了这个分类，才能选择这个分类下的标签和产品标签。

	- 模型管理

		在某个数据模块需要添加一些非标准的特殊内容的数据时，可以添加新模型，选定了相应基础模型即可，在新增模型之后不会立即创建数据表，需要在模型的字段管理里面添加字段才会完成才会创建表。

		- 基础

			上面已经说明了基础选项，请参照模型说明。

		- 设计
			
			**字段管理**，可以添加和管理模型即数据表的结构，具体操作请看**字段管理**。

			**表单显示分组**和**表单显示排序**结合使用，可以自定义字段在模块下数据的展示顺序和分组，表单显示分组格式为

				数字:分组名称;

			注意都为单字节字符。设置分组之后可以自由拖动字段到相应分组，既可以自由设置模块数据新增和编辑时候的展示表单页面。

			**列表定义**可以自定义在数据列表页面的展示方式和按钮，链接等，可参考例子修改。			

		- 高级

			目前没有使用，可扩展。

	- 字段管理

		- 字段名

			数据表的字段名称

		- 字段标题

			用于表单显示

		- **字段类型**
			
			可以方便快捷的新增和管理一个数据表字段，并一套生成表单展示逻辑，并可以在此基础上继续扩展字段类型。

			这里新扩展了很多类型的预设字段，比如厂商字段就使用了新扩展的**表内容选择**，可以直接管理厂商模块的数据到下载模块选择。

			*具体其他类型的使用请编写更详细的文档。*

		- **字段存储类型**
			
			用于预定义填写的表单数据存储到数据表之前的处理逻辑，目前只有函数处理，可以使用自定义函数处理填写数据，比如自动提取拼音首字母存储，而不是存储填写的数据。具体可以看说明。

			*具体其他类型的使用请编写更详细的文档。*

- 菜单管理

	由于使用的是基于访问的权限管理模式，这里和权限管理是紧密关联的，只有在这里有的菜单项，才可以作为一个权限项目被选择。

	当你希望只添加一个权限选项而不需要具体的菜单时，请在**是否隐藏**那里选择**隐藏**。

- 导航管理

	原有系统用于管理前台导航的模块，目前没有使用。

### 数据备份 ###

数据的备份和还原，需要完善，目前直接在服务器上面进行数据库的备份。

## 标签和产品标签 ##

这2个模块除了数据库和命名不同之外，其他功能都一样，故在一起说明。

### 分类管理 ###

所有的标签都需要从属于一个分类，每个分类都可以在**模型管理**里面勾选，被模型管理勾选的，才能在相应的数据模块下选择和显示。注：这里起作用的是附属模型，勾选数据模块的基础模型，目前没有意义，但是可以扩展。

### 标签管理 ###

选择一个分类，可以添加，管理标签，所有的标签的name都要不一样，在数据库是含有唯一性约束的字段。标签可以按照需求多级添加。

## 文章，下载，礼包 ##

这3个数据模块，除了某些比较特殊的操作，比如添加下载文件和地址，获取礼包中心的礼包，其他基本操作都一样。

### 数据管理 ###

常用的增删改查数据，操作方式就不一一列举。需要注意的是，这里的所有表单元素，也就是能看到的填写项目，都是根据**模型管理**动态生成的，所以也可以在**模型管理**里面很方便的管理这里得表单项，比如新增一个多选，或者新增一个副标题填写等。

### 特殊 ###

- 下载模块的下载管理

	- 添加下载

		可以填入需要添加的下载项数目，会自动生成相应的填写框。

	- 下载列表

		预定义站点，是预定义的下载服务器站，需要在**其他->预定义站点**填写，这里可以填写多个，方便切换下载服务器。

		名称即为下载文件名，地址即为在预定义站点的地址下的文件名或者文件地址。

- 礼包模块的卡号获取

	首先点击获取按钮，获取独立的礼包中心的数据，如果获取出错，请检查**礼包配置->礼包中心API接口访问KEY**，查看这里的账号密码是否在礼包中心的后台已经设置，没有设置，请同时设置礼包中心的后台，和当前站点后台配置。

	搜索数据可以搜素所需要的礼包中心的数据，数据量大了之后可以扩展这部分接口和功能。

	获取到数据之后，数据列表会有表格展示，下面可以翻页；需要获取的礼包数据双击，填写获取的卡号数目即可获取相应的卡号到当前这个数据，并自动把礼包中心填写的一些信息，比如标题，内容，礼包类型等导入到当前数据。注意。只有在最终确定添加，或者修改的时候，才会把卡号从礼包中心拿过来，如果不确定，不会拿取卡号。

- 礼包模块的卡号管理

	可以管理目前礼包数据的卡号，也可以看到是否被领取以及领取的IP。前台用户中心使用时，可以和前台用户联合处理，记录用户ID等等。

- 编辑器预设的插入管理

	主要分为插入下载数据，插入文章数据，插入内链数据。所有插入的数据，都可以搜索并选择，并可以选择**其他->模板管理**中设定的模板，可以为同一数据设定不同的插入展示模板。

	内链管理需要首先在**其他->内链管理**中添加才可以搜索到，同时也可以选择模板。


## 分类 ##

数据模块的分类管理操作相同，管理主要分为三组

- 基础

	发布内容，如果是一个不需要填写数据的一级栏目，这里选择不允许。

	是否审核，审核体系，目前没有完善，可扩展。

	允许文档类型，单一栏目可以添加多种类型数据，目前没有启用，可扩展，一般默认第一个主题。

	列表绑定文档模型，此栏目需要绑定的文档模型，即为当前模块的附属模型，可以在不同栏目绑定不同附属模型达到很灵活的效果。

	子文档绑定文档模型，数据本身可以添加子数据，目前没有启用，和列表绑定文档模型一样即可，可扩展。

- 高级

	填写SEO，分页页码，可见性等。目前SEO已经使用，分页页码，可见性都没有使用在前台，可根据需要使用或者扩展

- 模板

	- 栏目首页模板设置
		
		填写了这个项目，即为当前栏目为单个频道页，会按照你指定的路径规则，和模板文件生成一个单独的频道首页。

	- 栏目列表模板设置

		当前栏目为正常列表页，有自己的生成规则，可以自选多个模板，会生成多页列表。

		列表首页名称为和第一页同样内容的页面名称，用于SEO需求，比如你需要某个栏目列表页为lie/1.html,lie/2.html等等，但是希望第一页有这样一个访问地址lie/shouye.html，那么这里填写shouye即可。默认为index，即为lie/或者lie/index.html可以访问第一页。

	- 栏目详情模板设置

		当前栏目下面的数据页的模板以及生成规则.注意：如果数据本身填写了模板和路径的话，以数据本身为主。否则以数据所属栏目为主。

		编辑模板为原有系统遗留，将来可扩展为其他用途。

## 其他 ##

### 模板管理 ###

目前这里只管理了数据模块的编辑器上的数据库插入类型模板，包括插入文章，插入内链，插入下载的模板。这里可以扩展为整个后台和前台的模板管理并独立出来。

### 内链管理 ###

内链是预设的一组数据，在数据模块编辑器上插入，相应的模板可以在模板管理中选取。

### 友情链接 ###

友情链接管理。

### 预设站点管理 ###

预定义下载服务器站点管理，和**下载模块->下载管理**结合使用。

## 生成 ##

### 生成 ###

- PC版通用页面生成

	所有通用的页面如首页，列表，内容等的生成。注意列表和内容页，只默认生成一部分，全站生成目前使用脚本，请通知技术人员，将来需要扩展为后台可控制。

	*注意:生成数据模块的列表页和详情页的时候，会同时生成PC版和手机版*。

- PC版单页或特殊页生成

	在**生成->管理**模块中创建的PC版本单页或者特殊页面，会自动在这里创建一个生成按钮，供生成。

- 手机版页面生成

	在**生成->管理**模块中创建的手机版本单页或者特殊页面，会自动在这里创建一个生成按钮，供生成。

	这里有时候会提供手机版首页或者其他通用页生成，可根据不同站点需求调整。

### 管理 ###

目前这里所有的管理都是针对套模板的程序员开发，如果需要达到可以编辑人员方便的新增模板，并设计规则和生成路径的程度，还需要对易用性和模板管理，动态获取路径等做进一步开发。



## 专题 ##

专题系统目前可以初步使用，但是要达到一个比较完善的地步，需要进一步扩展用户交互选择，模板管理等等功能。*请同步完善这个文档*

所有专题都需要选择一个产品标签，所有的数据用产品标签产生联系。配置管理里面有专题的文件夹预设，可以预设专题生成的文件夹。

### 专题列表 ###

专题的管理，可以选择产品标签，选择模板，修改专题，添加标题等等。

### 专区列表 ###

管理与专题类似，不同与K页面和专题的是，一般专区为多页页面，所以可以填写父页面ID，让一个专区拥有多个页面。

### K页面列表 ###

与专题列表类似。

### 分类 ###

专题模块独立的分类模块，所有专题都可以选取这个分类，前台根据需要归类展示。

## 厂商管理 ##

目前预设在下载模块可以选取的厂商，有独立的生成路径等管理。

## 评论 ##

简单的评论模块，可继续扩展更多功能。










		
